<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mosaico de Imágenes desde Dropbox</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
</head>
<body>
  <script>
    var img;
    var pixelImages = [];
    var zoom = 1; // Factor de zoom
    var zoomIncrement = 0.1; // Incremento de zoom
    var zoomMin = 0.1; // Zoom mínimo
    var zoomMax = 10; // Zoom máximo
    var mouseXprev = 0;
    var mouseYprev = 0;

    function preload() {
      img = loadImage("https://cdn.glitch.global/c536c49d-7661-4fd9-81b8-918d12539028/almagua-escuela.jpg");
      pixelImages.push(loadImage("https://cdn.glitch.global/c536c49d-7661-4fd9-81b8-918d12539028/198845101_989500098492476_3555566408394435419_n.jpg")); // Reemplaza "URL_IMAGEN_192" con el enlace directo a la imagen correspondiente en Dropbox
      pixelImages.push(loadImage("https://cdn.glitch.global/c536c49d-7661-4fd9-81b8-918d12539028/434648224_348427008157091_217330225043198393_n.jpg")); // Reemplaza "URL_IMAGEN_128" con el enlace directo a la imagen correspondiente en Dropbox
      pixelImages.push(loadImage("https://cdn.glitch.global/c536c49d-7661-4fd9-81b8-918d12539028/429311705_779736447350065_4516433906161515358_n.jpg"));
      pixelImages.push(loadImage("https://cdn.glitch.global/c536c49d-7661-4fd9-81b8-918d12539028/348264971_589673896302117_8714738300620693336_n.jpg"));
      pixelImages.push(loadImage("https://cdn.glitch.global/c536c49d-7661-4fd9-81b8-918d12539028/435476568_2211153502567144_7128119928212242381_n.jpg"));
      pixelImages.push(loadImage("https://cdn.glitch.global/c536c49d-7661-4fd9-81b8-918d12539028/321517101_1554210981728190_2044147207454020108_n.jpg"));
      pixelImages.push(loadImage("https://cdn.glitch.global/c536c49d-7661-4fd9-81b8-918d12539028/132792727_837456340130678_6988730526045736713_n.jpg"));
      pixelImages.push(loadImage("https://cdn.glitch.global/c536c49d-7661-4fd9-81b8-918d12539028/423807720_903706265064322_1854665927748668977_n.jpg"));
    }

    function setup() { 
      createCanvas(img.width * zoom, img.height * zoom); // Tamaño del lienzo
      noLoop();
    }

    function draw() {
      background(0);

      img.loadPixels();
      
      var grid = 15 * zoom;
      var diameter = 18 * zoom;

      for (var y = 0; y < img.height; y += grid) {
        for (var x = 0; x < img.width; x += grid) {
          var pix = img.get(x, y);
          var closestImage = pixelImages[0];

          for (var i = 1; i < pixelImages.length; i++) {
            var dist1 = dist(pixelImages[i].levels[0], pixelImages[i].levels[1], pixelImages[i].levels[2], pix[0], pix[1], pix[2]);
            var dist2 = dist(closestImage.levels[0], closestImage.levels[1], closestImage.levels[2], pix[0], pix[1], pix[2]);
            if (abs(dist1 - pix.levels[0]) < abs(dist2 - pix.levels[0])) {
              closestImage = pixelImages[i];
            }
          }

          image(closestImage, x * zoom, y * zoom, diameter, diameter);
        }
      }
    }

    function mouseWheel(event) {
      var zoomDelta = event.delta > 0 ? -zoomIncrement : zoomIncrement;
      zoom = constrain(zoom + zoomDelta, zoomMin, zoomMax);
      resizeCanvas(img.width * zoom, img.height * zoom);
    }

    function mouseMoved() {
      var x = floor(mouseX / zoom);
      var y = floor(mouseY / zoom);
      if (x !== mouseXprev || y !== mouseYprev) {
        var pix = img.get(x, y);
        var closestImage = pixelImages[0];

        for (var i = 1; i < pixelImages.length; i++) {
          var dist1 = dist(pixelImages[i].levels[0], pixelImages[i].levels[1], pixelImages[i].levels[2], pix[0], pix[1], pix[2]);
          var dist2 = dist(closestImage.levels[0], closestImage.levels[1], closestImage.levels[2], pix[0], pix[1], pix[2]);
          if (abs(dist1 - pix.levels[0]) < abs(dist2 - pix.levels[0])) {
            closestImage = pixelImages[i];
          }
        }

        var grid = 15 * zoom;
        var diameter = 18 * zoom;
        var closestImageX = x * zoom;
        var closestImageY = y * zoom;

        image(closestImage, closestImageX, closestImageY, diameter, diameter);
        
        mouseXprev = x;
        mouseYprev = y;
      }
    }
  </script>
</body>
</html>
